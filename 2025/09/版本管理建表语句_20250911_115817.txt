1️⃣ 版本表 admin_version
CREATE TABLE admin_version (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '版本ID',
    platform TINYINT NOT NULL COMMENT '发布文件指定平台类型.如是PC的文件，是APP的文件：1=PC,2=APP,3=H5/其他',
    version_code INT NOT NULL COMMENT '数字版本号，用于比较大小',
    version_name VARCHAR(50) NOT NULL COMMENT '用户可见版本号',
    changelog TEXT COMMENT '更新日志',
    mandatory TINYINT(1) DEFAULT 0 COMMENT '是否强制更新，1=强制,0=非强制',
    upgrade_mode TINYINT(1) DEFAULT 0 COMMENT '升级类型：0=停止升级,1=全量用户升级,2=指定用户ID升级,3=指定用户数量升级',
    upgrade_user_count INT DEFAULT NULL COMMENT '指定升级用户数量，如指定500个用户，仅upgrade_mode=3有效',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    download_ok      INT UNSIGNED DEFAULT 0 COMMENT '总的下载成功次数',
    download_fail    INT UNSIGNED DEFAULT 0 COMMENT '总的下载失败次数',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    isdel tinyint NOT NULL DEFAULT 0 COMMENT '删除标记：0=未删除，1=已删除',
    isdel_time datetime NULL DEFAULT NULL COMMENT '删除时间',
    INDEX idx_platform_version(platform, version_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='应用版本信息表';

2️⃣ 版本文件源表 admin_version_source    
CREATE TABLE admin_version_source (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '文件源ID',
    version_id BIGINT NOT NULL COMMENT '关联 admin_version.id',
    download_ok INT UNSIGNED DEFAULT 0 COMMENT '下载成功次数',
    download_fail INT UNSIGNED DEFAULT 0 COMMENT '下载失败次数',
    source_url VARCHAR(255) NOT NULL COMMENT '文件下载地址路径,正常情况，你探测到的文件域名都可以下载',
    source_name VARCHAR(255) NOT NULL COMMENT '下载源文件名',
    source_size VARCHAR(255) NOT NULL COMMENT '下载源文件大小',
    source_type TINYINT DEFAULT 0 COMMENT '来源类型：1=域名服务器下载,2=OSS,3=GitHub,对应admin_domain.type',
    status TINYINT NOT NULL DEFAULT 0 COMMENT '文件上传状态：0=未上传,1=成功,2=失败',
    uploaded_at TIMESTAMP NULL DEFAULT NULL COMMENT '文件上传时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    isdel tinyint NOT NULL DEFAULT 0 COMMENT '删除标记：0=未删除，1=已删除',
    isdel_time datetime NULL DEFAULT NULL COMMENT '删除时间',
    CONSTRAINT fk_version FOREIGN KEY (version_id) REFERENCES admin_version(id)
        ON DELETE CASCADE ON UPDATE CASCADE,
    INDEX idx_version_source(version_id),
    INDEX idx_status(status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='版本文件下载源';


3️⃣ 用户当前版本表 admin_version_user
CREATE TABLE admin_version_user (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    staff_id BIGINT NOT NULL COMMENT '用户ID',
    pc_ver_code INT COMMENT 'PC 当前版本号',
    pc_ver_id BIGINT COMMENT '对应版本ID',
    pc_download_time TIMESTAMP COMMENT 'PC下载时间',
    pc_status TINYINT DEFAULT 0 COMMENT '下载状态：1=成功,0=失败',
    app_ver_code INT COMMENT 'APP 当前版本号',
    app_ver_id BIGINT COMMENT '对应版本ID',
    app_download_time TIMESTAMP COMMENT 'APP下载时间',
    app_status TINYINT DEFAULT 0 COMMENT '下载状态：1=成功,0=失败',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uniq_user(staff_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户当前版本信息表';

5️⃣ 版本指定用户表 admin_version_user_map
CREATE TABLE admin_version_user_map (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    version_id BIGINT NOT NULL COMMENT '关联 admin_version.id',
    staff_id BIGINT NOT NULL COMMENT '指定用户ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    CONSTRAINT fk_version_user FOREIGN KEY (version_id) REFERENCES admin_version(id)
        ON DELETE CASCADE ON UPDATE CASCADE,
    UNIQUE KEY uniq_version_user(version_id, staff_id),
    INDEX idx_user(staff_id),
    INDEX idx_version(version_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='指定用户下载版本（升级模式2=指定用户升级）';


4️⃣ 下载记录表 admin_version_download_log
CREATE TABLE admin_version_download_log (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    staff_id BIGINT NOT NULL COMMENT '用户ID',
    version_id BIGINT NOT NULL COMMENT '关联版本ID',
    platform TINYINT NOT NULL COMMENT '平台类型：1=PC,2=APP,3=H5/其他',
    source_id BIGINT NOT NULL COMMENT '下载源ID',
    source_url VARCHAR(255) NOT NULL COMMENT '下载源地址',
    status TINYINT NOT NULL DEFAULT 0 COMMENT '下载状态：1=成功,0=失败',
    fail_reason VARCHAR(255) DEFAULT NULL COMMENT '失败原因',
    isdel tinyint NOT NULL DEFAULT 0 COMMENT '删除标记：0=未删除，1=已删除',
    isdel_time datetime NULL DEFAULT NULL COMMENT '删除时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '下载时间',
    CONSTRAINT fk_version_log FOREIGN KEY (version_id) REFERENCES app_version(id)
        ON DELETE CASCADE ON UPDATE CASCADE,
    INDEX idx_user_version(staff_id, version_id),
    INDEX idx_version_platform(version_id, platform)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='版本下载记录表';